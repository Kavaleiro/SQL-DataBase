CREATE DATABASE LITORAL;
USE LITORAL;

CREATE TABLE CAPITAO(
	CPF CHAR(11) NOT NULL UNIQUE PRIMARY KEY,
    NOME VARCHAR(50) NOT NULL,
    ENDERECO VARCHAR(50) NOT NULL,
    NUMERO INT,
    CELULAR INT NOT NULL);

CREATE TABLE ESCUNA(
	NUMERO INT NOT NULL PRIMARY KEY,
    NOME VARCHAR(30) UNIQUE,
    CAPITAO_CPF CHAR(11) NOT NULL
    );
    
CREATE TABLE DESTINO(
	ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(50)
    );
    
CREATE TABLE PASSEIO(
	ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    DATA DATE,
    HORA_SAIDA TIME,
    HORA_CHEGADA TIME,
    ESCUNA_NUMERO INT NOT NULL,
    DESTINO_ID INT NOT NULL,
    FOREIGN KEY(ESCUNA_NUMERO) REFERENCES ESCUNA(NUMERO),
    FOREIGN KEY(DESTINO_ID) REFERENCES DESTINO(ID)
    
    );
CREATE TABLE VENDAS(
	NUMERO INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
    DESTINO_ID INT NOT NULL,
    EMBARQUE DATE,
    QTD INT NOT NULL,
    FOREIGN KEY(DESTINO_ID) REFERENCES DESTINO(ID)
    );
-- INSERINDO VALORES 
INSERT INTO CAPITAO
	VALUES(12345123451, "JACK", "RUA 1", 111, 123456789)
    ,(12345678912, "MARTA", "RUA 2", 211, 987654321)
    ,(98765432132, "ADRIANO", "RUA 3", 311, 132465798);
    
INSERT INTO ESCUNA VALUES
	(12345, "Black Flag", "1234567891"),
	(12346, "Caveira", "9876543219"),
    (12347, "Brazuca", "1472583697"),
    (12348, "Rosa Brilhante 1", "7418529631"),
    (12349, "Tubarão Ocean", "3692581473"),
    (12350, "Rosa Brilhante 2", "7418529631");
    
INSERT INTO DESTINO VALUES
	(0, "Ilha Dourada"),
    (0, "Ilha D’areia fina"),
    (0, "Ilha Encantada"),
    (0, "Ilha dos Ventos"),
    (0, "Ilhinha"),
    (0, "ILHA TORTA"),
    (0, "ILHA DOS SONHOS"),
    (0, "ILHA DO SONO")
    ;
    
INSERT INTO PASSEIO VALUES
	(0,20180102,080000,140000,12345,1),
    (0,20180102,070000,170000,12346,8),
    (0,20180102,080000,140000,12350,3),
    (0,20180103,060000,120000,12347,2),
    (0,20180103,070000,130000,12348,4),
    (0,20180103,080000,140000,12349,6),
    (0,20180103,090000,150000,12345,5),
    (0,20180104,070000,160000,12347,1),
    (0,20180104,070000,170000,12345,3),
    (0,20180104,090000,130000,12349,7),
    (0,20180105,100000,180000,12350,8)
    ;
-- ADICIONANDO "VALOR" NA TABELA DESTINO
ALTER TABLE DESTINO ADD COLUMN VALOR DECIMAL(5,2);
-- FAZENDO O UPDATE DA TABELA "DESTINO" NA COLUNA "VALOR"
UPDATE DESTINO SET VALOR = 100.00 WHERE NOME = "Ilha Dourada";
UPDATE DESTINO SET VALOR = 120.00 WHERE NOME = "Ilha D’areia fina";
UPDATE DESTINO SET VALOR = 80.00 WHERE NOME = "Ilha Encantada"; 
UPDATE DESTINO SET VALOR = 90.00 WHERE NOME = "Ilha dos Ventos"; 
UPDATE DESTINO SET VALOR = 100.00 WHERE NOME = "Ilhinha"; 
UPDATE DESTINO SET VALOR = 150.00 WHERE NOME = "ILHA TORTA"; 
UPDATE DESTINO SET VALOR = 120.00 WHERE NOME = "ILHA DOS SONHOS"; 
UPDATE DESTINO SET VALOR = 180.00 WHERE NOME = "ILHA DO SONO"; 

CREATE VIEW V_CONSULTA1 AS 
	SELECT ESCUNA.NOME AS "ESCUNA", DESTINO.NOME AS "ILHA", HORA_SAIDA AS "SAIDA", HORA_CHEGADA AS "CHEGADA", DATA
	FROM PASSEIO INNER JOIN ESCUNA, DESTINO 
	WHERE PASSEIO.ESCUNA_NUMERO = ESCUNA.NUMERO AND PASSEIO.DESTINO_ID = DESTINO.ID
	ORDER BY PASSEIO.DATA;

SELECT * FROM V_CONSULTA1;
SELECT * FROM DESTINO;